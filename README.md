pykpn
=====

A framework for modeling KPN applications and their execution on MPSoC
platforms.

Installation
------------

It is recommended to install pykpn within a virtual environment using Python
3.7. You can create a new environment with
```
virtualenv -p python3.7
```
Note that you can adjust the path to your needs. You can activate the previously created environment as follows:
```
source ~/source ~/virtualenvs/pykpn/bin/activate
```

Then you can install pykpn and all its dependencies:
```
python setup.py install
```

If you plan to modify the pykpn code base, you should install the package in
development mode:
```
python setup.py develop
```

This ensures that any modifications you make, will have an immediate effect to
your installed pykpn package.

You can now execute the pykpn command:
```
pykpn help
```

Configuration
-------------

pykpn uses [hydra](https://hydra.cc/) for its runtime configuration. The pykpn
package provides a basic set of general configuration files.
You can create your own configuration files and extend or override the default
ones. pykpn automatically loads all configuration files located in the local `conf/` directory. If that is not sufficient for your needs you can set the environment variable `export PYKPN_CONF_PATH=<path1>:<path2>:<...>` to contain more paths

Examples
--------

### Getting started

You can find some examples in the `example` directory. Make sure to `cd` to it in order to make the `example/conf` directory visible.
```
cd examples
```

You can validate the hydra search path and the loaded configurations by using
hydra in verbose mode. For instance:
```
pykpn help hydra.verbose=true
```

### Simple tasks

pykpn can execute one of several tasks. It expects the first argument to be a
valid task and all the remaining arguments are passed to hydra.  The `help`
task we used above gives an overview about all available tasks.

`kpn_to_dot` is a simple task that takes a kpn graph and produces a dot file
that represents this graph. There are a view kpn graphs available within the examples directory. See `examples/conf/kpn/`. For instance you can visualize the `audio_filter` application.
```
pykpn kpn_to_dot kpn=audio_filter
```

This will generate an output file `audio_filter.dot`. Note that hydra
outomatically chnages the `CWD` and places the generated output in a
subdirctory depending on the current time: `outputs/<date>/<time>/`.

The kpn graph above, is read from an xml file that is produced by the SLX tool
suite. If you have access to it and want to use other applications, you can
either create your own configurarion file similiar to `audio_filer.yaml` in
`conf/kpn/audio_filter.yaml` or you can use the generic `slx_reader`
configuration and override the hydra paramters
`kpn.name` and `kpn.file` like so:
```
pykpn kpn_to_dot kpn=sxc_reader kpn.name=<name> kpn.file=<path_to_xml>
```

Hydra allows to print the whole configuration tree using the `-c`
argument. This gives you an overview of the parameters available for the task.
```
pykpn kpn_to_dot kpn=audio_filter -c job
```

Apart from SLX files, pykpn can also read TGFF files:
```
pykpn kpn_to_dot kpn=tgff_reader -c job
```

On default, this reads `auto-indust-cords.tgff` from `examples/tgff/e3s-0.9`.
This default behavior is defined in `examples/conf/tgff/default.yaml`, which
also shows how the local `conf` directory can be used to override the default
configuration of pykpn. Of course, `tgff.directory` and `tgff.file` can also be
set using command line args.

### Simulation

One of pykpn's most important tasks is `simulate`. It simulates the exectution
of a KPN application on a given platform. For this, we need also a mapping
that maps KPN nodes to processors in the platform and traces that describe
the runtime behavior of the application. For instance:
```
pykpn simulate kpn=audio_filter platform=exynos trace=slx_default mapping=slx_default
```

This executed the Audio Filter application on an Exynos chip using the default traces and mappings as generated by SLX. Alternatively, we could also use a random mapping like so:

```
pykpn simulate kpn=audio_filter platform=exynos trace=slx_default mapping=random_mapping
```

This works also for TGFF:
pykpn simulate kpn=tgff_reader platform=tgff_reader trace=tgff_reader mapping=random_mapping

For TGFF, all the information is read from the same file. Since there is no
mapping information in the files, a random mapping needs to be generated. Since
the command above is quite redundant, we provide a shortcut:
```
pykpn simulate base_conf=tgff
```

Documentation
-------------

For more information, please refert to the online documentation:
https://cc.inf.tu-dresden.de/pykpn/
